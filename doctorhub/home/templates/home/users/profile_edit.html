{% extends 'doctorhub/layouts/rtl/light/green/master.html' %}

{% load staticfiles %}
{% load pages %}

{% block additional_css %}

    <link rel="stylesheet" href="{% static 'doctorhub/more/css/persian-datepicker.min.css' %}"/>

{% endblock %}

{% block page_title %}

{% endblock %}

{% block breadcrumb %}

    <li class="breadcrumb-item active">
        ويرايش
    </li>

    <li class="breadcrumb-item">
        <a href="">
            حساب كاربرى
        </a>
    </li>

{% endblock %}

{% block main_content %}

    {% load staticfiles %}
    {% load crispy_forms_tags %}
    {% load pages %}

    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <div class="card border-success">
                <div class="card-header bg-success text-center">
                    <img src="{% static 'doctorhub/assets/images/logo-light-text.png' %}"
                         alt="DigitalTeb" class="dark-logo"/>
                </div>
                <div class="card-body bg-dark" style="padding-left: 10%; padding-right: 10%;">
                    <form action="{% url 'edit_account' %}"
                          enctype="multipart/form-data"
                          onsubmit="set_gregorian_date()"
                          method="POST">
                        {% csrf_token %}
                        <div class="form-row">
                            <div class="col-md-4">
                                {{ profile_form.profile_image|as_crispy_field }}
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-4 mb-0">
                                {{ user_form.username|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-4 mb-0">
                                {{ user_form.first_name|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-4 mb-0">
                                {{ user_form.last_name|as_crispy_field }}
                            </div>

                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-4 mb-0">
                                {{ profile_form.gender|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-4 mb-0">
                                {{ phone_form.number|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-4 mb-0">
                                {{ profile_form.birthdate|as_crispy_field }}
                                <input type="hidden" id="birthdate-input">
                            </div>
                        </div>
                        <br>
                        <br>
                        <div class="form-row">
                            <div class="col-md-4"></div>
                            <div class="col-md-4">
                                <button type="submit"
                                        style="width: 100%; height: 100%;"
                                        class="btn btn-success btn-lg">
                                    ثبت تغييرات
                                </button>
                            </div>
                            <div class="col-md-4"></div>
                        </div>
                        <br>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-1"></div>
    </div>

{% endblock %}

{% block additional_js %}

    <script src="{% static 'doctorhub/more/js/persian-date.min.js' %}"></script>
    <script src="{% static 'doctorhub/more/js/persian-datepicker.min.js' %}"></script>

    <script>

        function setPersianDatePicker() {
            $(".persian-datepicker").persianDatepicker(
                {
                    formatter: function (unixDate) {
                        var gregorianDate = new Date(unixDate);
                        var day = gregorianDate.getDate().toString();
                        var month = (gregorianDate.getMonth() + 1).toString();
                        var year = gregorianDate.getFullYear().toString();
                        $('#birthdate-input').val(
                            year + '-' + month + '-' + day
                        );
                        var pdate = new persianDate(unixDate);
                        day = pdate.date().toString();
                        month = pdate.month().toString();
                        year = pdate.year().toString();
                        return year + '/' + month + '/' + day
                    },
                    autoClose: true,
                    {#initialValue: false,#}
                }
            );
        }

        function set_gregorian_date() {
            $(".persian-datepicker").val(
                $('#birthdate-input').val()
            );
        }

        $(document).ready(
            setPersianDatePicker()
        );

    </script>

{% endblock %}